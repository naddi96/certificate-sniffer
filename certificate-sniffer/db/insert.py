import sqlite3
from sqlite3 import Error
from datetime import date
from os import name
import sys
import time
import json
import binascii
from hashlib import sha256
import OpenSSL
from dateutil import parser


def create_connection(db_file):
    """ create a database connection to the SQLite database
        specified by db_file
    :param db_file: database file
    :return: Connection object or None
    """
    conn = None
    try:
        conn = sqlite3.connect(db_file)
    except Error as e:
        print(e)

    return conn


def create_project(conn, project):
    """
    Create a new project into the projects table
    :param conn:
    :param project:
    :return: project id
    """
    sql = ''' INSERT INTO projects(name,begin_date,end_date)
              VALUES(?,?,?) '''
    cur = conn.cursor()
    cur.execute(sql, project)
    conn.commit()
    return cur.lastrowid


def create_task(conn, task):
    """
    Create a new task
    :param conn:
    :param task:
    :return:
    """
    sql = ''' INSERT INTO tasks(name,priority,status_id,project_id,begin_date,end_date)
              VALUES(?,?,?,?,?,?) '''
    cur = conn.cursor()
    cur.execute(sql, task)
    conn.commit()
    return cur.lastrowid


def load_certificate_info(cer):
    cert = OpenSSL.crypto.load_certificate(OpenSSL.crypto.FILETYPE_ASN1, binascii.unhexlify(cer.replace(":","")))
    dns_set=set()
    for item in cert.get_subject().get_components():
        if item[0]==b"CN":
            print(item[0].decode("utf-8"), "  ——  ",item[1].decode("utf-8"))
    
    for i in range(0,cert.get_extension_count()):
        if b"subjectAltName" == cert.get_extension(i).get_short_name():
                
                dns_set=set(cert.get_extension(i)
                                ._subjectAltNameString()
                                .replace("DNS:","")
                                .replace("*","%")
                                .replace(" ","")
                                .split(","))
    
    name=""
    for item in cert.get_subject().get_components():
        if item[0]==b"CN":
            name=item[1].decode("utf-8").replace("*","%").replace(" ","")
            dns_set.add(name)       

    valid_from = parser.parse(cert.get_notBefore().decode("UTF-8")).timestamp() #strftime('%Y-%m-%d %H:%M:%S') 
    valid_to = parser.parse(cert.get_notAfter().decode("UTF-8")).timestamp()
    ca=""
    for item in cert.get_issuer().get_components():
        if item[0]==b"CN":
            ca=item[1].decode("utf-8")
    sha_256=sha256(cer.encode('utf-8')).hexdigest()
    return {
            "name":name,
            "dns":dns_set,
            "valid_from":valid_from, 
            "valid_to":valid_to,
            "CA":ca,
            "sha256":sha_256 ,
            "certificate":cer
            }


def main():
    database = r"sqlite.db"

    cer3= "30:82:06:bf:30:82:05:a7:a0:03:02:01:02:02:10:06:df:d9:4f:40:3c:8f:9b:2e:12:1c:2e:0d:99:47:74:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:30:44:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:15:30:13:06:03:55:04:0a:13:0c:44:69:67:69:43:65:72:74:20:49:6e:63:31:1e:30:1c:06:03:55:04:03:13:15:44:69:67:69:43:65:72:74:20:47:6c:6f:62:61:6c:20:43:41:20:47:32:30:1e:17:0d:32:30:31:31:31:30:30:30:30:30:30:30:5a:17:0d:32:31:31:31:30:34:32:33:35:39:35:39:5a:30:67:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:13:30:11:06:03:55:04:08:13:0a:57:61:73:68:69:6e:67:74:6f:6e:31:10:30:0e:06:03:55:04:07:13:07:53:65:61:74:74:6c:65:31:19:30:17:06:03:55:04:0a:13:10:41:6d:61:7a:6f:6e:2e:63:6f:6d:2c:20:49:6e:63:2e:31:16:30:14:06:03:55:04:03:13:0d:77:77:77:2e:61:6d:61:7a:6f:6e:2e:69:74:30:82:01:22:30:0d:06:09:2a:86:48:86:f7:0d:01:01:01:05:00:03:82:01:0f:00:30:82:01:0a:02:82:01:01:00:c5:1d:57:45:2b:0c:47:ac:42:b5:64:29:21:ac:1e:6b:f2:36:f1:5c:8d:e4:73:e0:6f:e0:9f:9f:a2:ac:63:1c:67:f5:11:fb:e5:48:c9:fa:88:d0:6b:12:5f:21:67:58:a7:65:cb:37:d3:d6:16:7c:81:02:2c:c1:00:3f:77:66:6f:a5:ad:23:a6:f5:35:35:a6:51:6a:60:8d:98:d4:66:e3:ad:9c:13:cb:f9:4a:a6:33:c9:eb:2b:a6:88:cb:c8:73:a0:a5:ad:f4:b7:bc:2d:cb:d9:ce:ef:70:db:e1:da:f8:50:c5:b8:17:65:22:d2:4e:cd:82:fd:4d:7c:3b:7e:83:3a:29:42:19:e1:ab:90:4d:12:68:aa:1d:ed:74:e5:08:56:b8:09:06:b8:69:0b:ae:30:f1:81:8c:a0:e5:14:bc:b7:11:a0:26:12:69:18:14:3d:af:0d:5a:96:7f:8b:6d:49:f0:20:a6:ee:a2:b1:af:29:3f:63:58:62:14:29:cb:26:56:2e:56:3d:e5:d9:71:34:7b:ca:08:df:a0:b1:d2:de:c5:89:69:7c:d4:dc:ed:0a:d1:8a:b6:a4:e4:95:aa:8b:64:93:fe:c2:d4:31:21:c7:21:e4:28:10:56:e3:ac:bd:d4:0a:9e:24:38:8c:7a:17:bd:7f:07:a9:d1:97:02:03:01:00:01:a3:82:03:88:30:82:03:84:30:1f:06:03:55:1d:23:04:18:30:16:80:14:24:6e:2b:2d:d0:6a:92:51:51:25:69:01:aa:9a:47:a6:89:e7:40:20:30:1d:06:03:55:1d:0e:04:16:04:14:a9:10:2a:c4:4e:68:42:cc:48:9a:60:94:af:8e:0c:05:c1:ba:98:4f:30:81:c2:06:03:55:1d:11:04:81:ba:30:81:b7:82:11:77:77:77:2e:63:64:6e:2e:61:6d:61:7a:6f:6e:2e:69:74:82:0d:77:77:77:2e:61:6d:61:7a:6f:6e:2e:69:74:82:23:70:2d:79:6f:2d:77:77:77:2d:61:6d:61:7a:6f:6e:2d:69:74:2d:6b:61:6c:69:61:73:2e:61:6d:61:7a:6f:6e:2e:69:74:82:23:70:2d:79:33:2d:77:77:77:2d:61:6d:61:7a:6f:6e:2d:69:74:2d:6b:61:6c:69:61:73:2e:61:6d:61:7a:6f:6e:2e:69:74:82:23:70:2d:6e:74:2d:77:77:77:2d:61:6d:61:7a:6f:6e:2d:69:74:2d:6b:61:6c:69:61:73:2e:61:6d:61:7a:6f:6e:2e:69:74:82:19:6d:61:74:63:68:2e:61:6d:61:7a:6f:6e:62:72:6f:77:73:65:72:61:70:70:2e:69:74:82:09:61:6d:61:7a:6f:6e:2e:69:74:30:0e:06:03:55:1d:0f:01:01:ff:04:04:03:02:05:a0:30:1d:06:03:55:1d:25:04:16:30:14:06:08:2b:06:01:05:05:07:03:01:06:08:2b:06:01:05:05:07:03:02:30:77:06:03:55:1d:1f:04:70:30:6e:30:35:a0:33:a0:31:86:2f:68:74:74:70:3a:2f:2f:63:72:6c:33:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:44:69:67:69:43:65:72:74:47:6c:6f:62:61:6c:43:41:47:32:2e:63:72:6c:30:35:a0:33:a0:31:86:2f:68:74:74:70:3a:2f:2f:63:72:6c:34:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:44:69:67:69:43:65:72:74:47:6c:6f:62:61:6c:43:41:47:32:2e:63:72:6c:30:4c:06:03:55:1d:20:04:45:30:43:30:37:06:09:60:86:48:01:86:fd:6c:01:01:30:2a:30:28:06:08:2b:06:01:05:05:07:02:01:16:1c:68:74:74:70:73:3a:2f:2f:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:43:50:53:30:08:06:06:67:81:0c:01:02:02:30:74:06:08:2b:06:01:05:05:07:01:01:04:68:30:66:30:24:06:08:2b:06:01:05:05:07:30:01:86:18:68:74:74:70:3a:2f:2f:6f:63:73:70:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:30:3e:06:08:2b:06:01:05:05:07:30:02:86:32:68:74:74:70:3a:2f:2f:63:61:63:65:72:74:73:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:44:69:67:69:43:65:72:74:47:6c:6f:62:61:6c:43:41:47:32:2e:63:72:74:30:09:06:03:55:1d:13:04:02:30:00:30:82:01:04:06:0a:2b:06:01:04:01:d6:79:02:04:02:04:81:f5:04:81:f2:00:f0:00:75:00:f6:5c:94:2f:d1:77:30:22:14:54:18:08:30:94:56:8e:e3:4d:13:19:33:bf:df:0c:2f:20:0b:cc:4e:f1:64:e3:00:00:01:75:af:e6:fd:d5:00:00:04:03:00:46:30:44:02:20:16:41:ef:5f:b3:0b:b9:a8:ca:7a:b6:7e:dc:74:e5:05:17:74:57:01:3e:0a:f2:87:a0:1a:39:08:24:16:2e:42:02:20:51:b0:74:c4:41:b7:5c:b9:b1:4d:e8:33:2c:f2:2c:0e:e0:68:58:d8:1a:c8:a4:48:35:4b:44:44:95:f0:5d:57:00:77:00:5c:dc:43:92:fe:e6:ab:45:44:b1:5e:9a:d4:56:e6:10:37:fb:d5:fa:47:dc:a1:73:94:b2:5e:e6:f6:c7:0e:ca:00:00:01:75:af:e6:fe:2f:00:00:04:03:00:48:30:46:02:21:00:8a:6f:a9:be:fc:8c:c8:76:3e:97:c6:3d:b1:8b:d8:d0:d2:a0:b8:8c:b4:b1:5f:42:9e:f9:6f:e3:7a:7f:be:31:02:21:00:bb:63:a9:b6:ee:60:f4:2d:36:0d:52:a4:1b:aa:82:92:e6:61:91:b5:9d:e4:3c:9a:22:22:30:37:be:51:ba:4c:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:03:82:01:01:00:07:54:42:76:02:f5:bb:c2:7e:37:a0:2c:ab:23:ae:fb:35:b3:94:00:d7:e3:f8:dd:7d:4c:66:a6:75:4e:20:29:76:6a:32:55:09:ad:5d:ba:f2:ee:cb:9b:c6:1b:ad:75:c8:d1:57:8b:19:fc:76:8f:1f:a5:c4:a7:5a:ef:e1:74:99:23:e6:6e:b5:ce:5c:ca:b5:65:77:0b:c3:1d:a8:6b:3f:51:b4:69:73:a7:5b:ce:0f:bf:00:9c:23:18:34:f0:a1:64:be:c4:d1:c3:d1:2d:2c:5f:47:e2:2f:71:1f:a1:4a:e3:4d:d7:6f:d6:73:41:7e:62:ae:17:2a:29:5d:f6:93:67:7e:33:d3:ef:e3:cb:e8:9a:41:9b:27:0b:a9:8c:0c:b4:95:35:15:07:12:89:c0:a3:50:98:13:bb:03:6f:19:42:60:79:19:2d:23:73:6f:5b:46:33:7e:85:9b:c6:a9:bf:3d:05:36:b7:01:2b:4f:10:ab:df:33:16:b4:03:b4:9f:8e:8e:04:50:a2:29:2e:01:4e:f0:91:38:82:ed:eb:6f:db:a3:65:86:25:c9:30:89:7f:dd:4b:dc:cc:0b:6d:d2:0f:a7:48:f3:d7:f5:2b:41:e0:19:a2:0c:1b:47:d8:80:9f:b1:be:84:39:3d:e0:df:fa:96:06:c0:93:a1"
    cer1 ="30:82:04:b1:30:82:03:99:a0:03:02:01:02:02:10:04:e1:e7:a4:dc:5c:f2:f3:6d:c0:2b:42:b8:5d:15:9f:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:30:6c:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:15:30:13:06:03:55:04:0a:13:0c:44:69:67:69:43:65:72:74:20:49:6e:63:31:19:30:17:06:03:55:04:0b:13:10:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:31:2b:30:29:06:03:55:04:03:13:22:44:69:67:69:43:65:72:74:20:48:69:67:68:20:41:73:73:75:72:61:6e:63:65:20:45:56:20:52:6f:6f:74:20:43:41:30:1e:17:0d:31:33:31:30:32:32:31:32:30:30:30:30:5a:17:0d:32:38:31:30:32:32:31:32:30:30:30:30:5a:30:70:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:15:30:13:06:03:55:04:0a:13:0c:44:69:67:69:43:65:72:74:20:49:6e:63:31:19:30:17:06:03:55:04:0b:13:10:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:31:2f:30:2d:06:03:55:04:03:13:26:44:69:67:69:43:65:72:74:20:53:48:41:32:20:48:69:67:68:20:41:73:73:75:72:61:6e:63:65:20:53:65:72:76:65:72:20:43:41:30:82:01:22:30:0d:06:09:2a:86:48:86:f7:0d:01:01:01:05:00:03:82:01:0f:00:30:82:01:0a:02:82:01:01:00:b6:e0:2f:c2:24:06:c8:6d:04:5f:d7:ef:0a:64:06:b2:7d:22:26:65:16:ae:42:40:9b:ce:dc:9f:9f:76:07:3e:c3:30:55:87:19:b9:4f:94:0e:5a:94:1f:55:56:b4:c2:02:2a:af:d0:98:ee:0b:40:d7:c4:d0:3b:72:c8:14:9e:ef:90:b1:11:a9:ae:d2:c8:b8:43:3a:d9:0b:0b:d5:d5:95:f5:40:af:c8:1d:ed:4d:9c:5f:57:b7:86:50:68:99:f5:8a:da:d2:c7:05:1f:a8:97:c9:dc:a4:b1:82:84:2d:c6:ad:a5:9c:c7:19:82:a6:85:0f:5e:44:58:2a:37:8f:fd:35:f1:0b:08:27:32:5a:f5:bb:8b:9e:a4:bd:51:d0:27:e2:dd:3b:42:33:a3:05:28:c4:bb:28:cc:9a:ac:2b:23:0d:78:c6:7b:e6:5e:71:b7:4a:3e:08:fb:81:b7:16:16:a1:9d:23:12:4d:e5:d7:92:08:ac:75:a4:9c:ba:cd:17:b2:1e:44:35:65:7f:53:25:39:d1:1c:0a:9a:63:1b:19:92:74:68:0a:37:c2:c2:52:48:cb:39:5a:a2:b6:e1:5d:c1:dd:a0:20:b8:21:a2:93:26:6f:14:4a:21:41:c7:ed:6d:9b:f2:48:2f:f3:03:f5:a2:68:92:53:2f:5e:e3:02:03:01:00:01:a3:82:01:49:30:82:01:45:30:12:06:03:55:1d:13:01:01:ff:04:08:30:06:01:01:ff:02:01:00:30:0e:06:03:55:1d:0f:01:01:ff:04:04:03:02:01:86:30:1d:06:03:55:1d:25:04:16:30:14:06:08:2b:06:01:05:05:07:03:01:06:08:2b:06:01:05:05:07:03:02:30:34:06:08:2b:06:01:05:05:07:01:01:04:28:30:26:30:24:06:08:2b:06:01:05:05:07:30:01:86:18:68:74:74:70:3a:2f:2f:6f:63:73:70:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:30:4b:06:03:55:1d:1f:04:44:30:42:30:40:a0:3e:a0:3c:86:3a:68:74:74:70:3a:2f:2f:63:72:6c:34:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:44:69:67:69:43:65:72:74:48:69:67:68:41:73:73:75:72:61:6e:63:65:45:56:52:6f:6f:74:43:41:2e:63:72:6c:30:3d:06:03:55:1d:20:04:36:30:34:30:32:06:04:55:1d:20:00:30:2a:30:28:06:08:2b:06:01:05:05:07:02:01:16:1c:68:74:74:70:73:3a:2f:2f:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:43:50:53:30:1d:06:03:55:1d:0e:04:16:04:14:51:68:ff:90:af:02:07:75:3c:cc:d9:65:64:62:a2:12:b8:59:72:3b:30:1f:06:03:55:1d:23:04:18:30:16:80:14:b1:3e:c3:69:03:f8:bf:47:01:d4:98:26:1a:08:02:ef:63:64:2b:c3:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:03:82:01:01:00:18:8a:95:89:03:e6:6d:df:5c:fc:1d:68:ea:4a:8f:83:d6:51:2f:8d:6b:44:16:9e:ac:63:f5:d2:6e:6c:84:99:8b:aa:81:71:84:5b:ed:34:4e:b0:b7:79:92:29:cc:2d:80:6a:f0:8e:20:e1:79:a4:fe:03:47:13:ea:f5:86:ca:59:71:7d:f4:04:96:6b:d3:59:58:3d:fe:d3:31:25:5c:18:38:84:a3:e6:9f:82:fd:8c:5b:98:31:4e:cd:78:9e:1a:fd:85:cb:49:aa:f2:27:8b:99:72:fc:3e:aa:d5:41:0b:da:d5:36:a1:bf:1c:6e:47:49:7f:5e:d9:48:7c:03:d9:fd:8b:49:a0:98:26:42:40:eb:d6:92:11:a4:64:0a:57:54:c4:f5:1d:d6:02:5e:6b:ac:ee:c4:80:9a:12:72:fa:56:93:d7:ff:bf:30:85:06:30:bf:0b:7f:4e:ff:57:05:9d:24:ed:85:c3:2b:fb:a6:75:a8:ac:2d:16:ef:7d:79:27:b2:eb:c2:9d:0b:07:ea:aa:85:d3:01:a3:20:28:41:59:43:28:d2:81:e3:aa:f6:ec:7b:3b:77:b6:40:62:80:05:41:45:01:ef:17:06:3e:de:c0:33:9b:67:d3:61:2e:72:87:e4:69:fc:12:00:57:40:1e:70:f5:1e:c9:b4"
    cer= "30:82:06:75:30:82:05:5d:a0:03:02:01:02:02:10:09:b3:a8:db:26:ac:f2:1e:46:2b:11:d7:2d:70:55:50:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:30:70:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:15:30:13:06:03:55:04:0a:13:0c:44:69:67:69:43:65:72:74:20:49:6e:63:31:19:30:17:06:03:55:04:0b:13:10:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:31:2f:30:2d:06:03:55:04:03:13:26:44:69:67:69:43:65:72:74:20:53:48:41:32:20:48:69:67:68:20:41:73:73:75:72:61:6e:63:65:20:53:65:72:76:65:72:20:43:41:30:1e:17:0d:32:30:30:38:31:33:30:30:30:30:30:30:5a:17:0d:32:31:30:38:31:38:31:32:30:30:30:30:5a:30:81:83:31:0b:30:09:06:03:55:04:06:13:02:55:53:31:13:30:11:06:03:55:04:08:13:0a:43:61:6c:69:66:6f:72:6e:69:61:31:16:30:14:06:03:55:04:07:13:0d:53:61:6e:20:46:72:61:6e:63:69:73:63:6f:31:16:30:14:06:03:55:04:0a:13:0d:54:77:69:74:74:65:72:2c:20:49:6e:63:2e:31:19:30:17:06:03:55:04:0b:13:10:54:77:69:74:74:65:72:20:53:65:63:75:72:69:74:79:31:14:30:12:06:03:55:04:03:0c:0b:2a:2e:74:77:69:6d:67:2e:63:6f:6d:30:82:01:22:30:0d:06:09:2a:86:48:86:f7:0d:01:01:01:05:00:03:82:01:0f:00:30:82:01:0a:02:82:01:01:00:aa:17:39:dc:5a:21:09:f2:4c:0d:56:e1:cf:ea:6c:c1:f7:a0:af:7f:b0:65:a0:26:d3:db:f2:2b:79:5c:2c:2d:3a:21:76:7b:3a:41:9b:ae:f1:9e:94:9f:10:34:2e:c3:ec:c3:4c:34:9b:80:08:0f:b1:ba:1b:b2:cd:ca:87:2f:6b:2b:6b:8f:b7:0e:df:6d:88:67:12:48:1d:7e:f3:80:3c:d3:89:d6:51:55:85:a3:c3:df:be:e1:35:08:80:c9:26:55:12:f6:82:fd:58:74:c5:70:dd:83:94:46:b6:37:b7:10:0a:5d:91:ba:66:f5:52:68:a4:e6:87:3c:6c:8e:9a:71:95:c3:7c:ae:e3:af:31:cf:cf:8c:0d:12:69:4a:ae:1d:45:ee:c4:4b:01:55:08:8a:48:7a:3f:26:4b:74:35:18:b7:a1:3e:e4:3d:91:8a:3b:ac:89:75:25:70:92:02:01:0c:5b:5c:0e:4d:4d:5c:6f:a9:f9:e2:d0:f7:db:88:1e:91:35:5e:c0:5e:4c:b0:2e:fe:23:25:f0:1f:e2:5e:85:d2:64:04:a9:b4:e5:5a:a0:e9:c5:cf:be:a5:e9:aa:e4:d1:9b:90:d2:01:86:4f:9a:e9:b1:e8:57:6a:ab:16:ff:54:05:0d:6e:98:65:f8:98:10:b0:98:c5:5a:1b:02:03:01:00:01:a3:82:02:f5:30:82:02:f1:30:1f:06:03:55:1d:23:04:18:30:16:80:14:51:68:ff:90:af:02:07:75:3c:cc:d9:65:64:62:a2:12:b8:59:72:3b:30:1d:06:03:55:1d:0e:04:16:04:14:13:f8:d0:19:57:87:cb:06:df:89:2e:36:ae:17:a1:f5:35:a7:c8:64:30:21:06:03:55:1d:11:04:1a:30:18:82:0b:2a:2e:74:77:69:6d:67:2e:63:6f:6d:82:09:74:77:69:6d:67:2e:63:6f:6d:30:0e:06:03:55:1d:0f:01:01:ff:04:04:03:02:05:a0:30:1d:06:03:55:1d:25:04:16:30:14:06:08:2b:06:01:05:05:07:03:01:06:08:2b:06:01:05:05:07:03:02:30:75:06:03:55:1d:1f:04:6e:30:6c:30:34:a0:32:a0:30:86:2e:68:74:74:70:3a:2f:2f:63:72:6c:33:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:73:68:61:32:2d:68:61:2d:73:65:72:76:65:72:2d:67:36:2e:63:72:6c:30:34:a0:32:a0:30:86:2e:68:74:74:70:3a:2f:2f:63:72:6c:34:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:73:68:61:32:2d:68:61:2d:73:65:72:76:65:72:2d:67:36:2e:63:72:6c:30:4c:06:03:55:1d:20:04:45:30:43:30:37:06:09:60:86:48:01:86:fd:6c:01:01:30:2a:30:28:06:08:2b:06:01:05:05:07:02:01:16:1c:68:74:74:70:73:3a:2f:2f:77:77:77:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:43:50:53:30:08:06:06:67:81:0c:01:02:02:30:81:83:06:08:2b:06:01:05:05:07:01:01:04:77:30:75:30:24:06:08:2b:06:01:05:05:07:30:01:86:18:68:74:74:70:3a:2f:2f:6f:63:73:70:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:30:4d:06:08:2b:06:01:05:05:07:30:02:86:41:68:74:74:70:3a:2f:2f:63:61:63:65:72:74:73:2e:64:69:67:69:63:65:72:74:2e:63:6f:6d:2f:44:69:67:69:43:65:72:74:53:48:41:32:48:69:67:68:41:73:73:75:72:61:6e:63:65:53:65:72:76:65:72:43:41:2e:63:72:74:30:0c:06:03:55:1d:13:01:01:ff:04:02:30:00:30:82:01:02:06:0a:2b:06:01:04:01:d6:79:02:04:02:04:81:f3:04:81:f0:00:ee:00:75:00:f6:5c:94:2f:d1:77:30:22:14:54:18:08:30:94:56:8e:e3:4d:13:19:33:bf:df:0c:2f:20:0b:cc:4e:f1:64:e3:00:00:01:73:e8:b8:53:8c:00:00:04:03:00:46:30:44:02:20:22:37:39:03:41:d2:d4:4b:7c:5c:cf:d3:b0:60:d5:f8:3d:0d:a0:46:6e:34:bf:0b:fd:2d:89:7f:07:bd:c9:a2:02:20:6a:8f:b4:7c:c5:ea:02:64:22:c7:c1:2e:fd:77:59:fe:9d:7a:44:89:2b:08:29:b6:e2:64:0a:07:ad:30:ee:1a:00:75:00:5c:dc:43:92:fe:e6:ab:45:44:b1:5e:9a:d4:56:e6:10:37:fb:d5:fa:47:dc:a1:73:94:b2:5e:e6:f6:c7:0e:ca:00:00:01:73:e8:b8:53:be:00:00:04:03:00:46:30:44:02:20:41:07:08:1e:fd:5e:c0:b9:5d:95:9e:8e:0d:75:f8:dd:e1:0b:c3:40:6d:a4:d3:c8:86:b4:da:ef:2a:72:82:3b:02:20:3b:f8:ed:c4:7f:d9:af:8f:89:48:14:0c:8e:57:8b:49:d4:8d:38:ef:60:bd:aa:c1:fa:e4:39:9f:fe:61:2e:10:30:0d:06:09:2a:86:48:86:f7:0d:01:01:0b:05:00:03:82:01:01:00:16:e5:09:83:b6:a5:2a:b1:9f:70:57:26:46:8c:36:ab:ab:ac:85:d8:37:f7:89:31:ca:7f:d0:f3:0e:c7:95:67:c9:21:e0:95:6f:f9:77:e8:ea:7f:14:e0:1e:8b:82:6e:d6:b9:97:c4:14:f2:36:d3:47:b4:8e:7a:a6:57:13:c9:a8:a9:5e:0e:a1:53:7c:e3:b7:74:2e:9e:a3:1f:43:9a:c5:f8:35:92:5b:88:88:2c:41:15:92:3d:61:1a:06:10:c9:3f:01:e0:e4:cd:1b:4c:f5:ba:06:55:d5:08:58:5c:da:ee:b3:75:67:96:12:24:58:bc:87:1d:69:db:92:a2:85:6a:34:05:f0:0d:03:0d:e1:e2:29:25:b6:21:92:ad:7e:e0:d9:a2:61:96:fd:d4:b3:30:6d:f1:30:43:b2:7b:b1:80:01:8e:59:64:1f:5d:49:d4:8d:d1:c2:0d:f2:61:72:61:25:a6:74:73:4d:4f:94:ab:e2:fe:67:7c:f5:3c:be:5a:3f:a8:b9:ff:80:7e:a1:85:49:06:18:4f:e9:c5:45:59:9b:e4:fe:c4:fa:da:b0:75:74:bd:c8:ce:4f:58:8f:32:bf:4f:3c:73:bc:92:54:6c:55:db:a8:20:27:30:ea:e4:55:44:be:61:50:e2:d9:af:c4:b3:c0:18:ae:eb"

    cert_data=load_certificate_info(cer)

    '''   
    select certificati.id,certificati.hash,nomi_domino.nome from certificati join nomi_domino where certificati.id =nomi_domino.certificato
    hash text UNIQUE NOT NULL,


    select certificati.hash  from nomi_domino join certificati where "dixcvxc xvdxfgfdo cane.twimg.com" like nomi_domino.nome and nomi_domino.certificato= certificati.id

                                                certificato BLOB NOT NULL,
                                                frequenza INTEGER NOT NULL,
                                                CA text NOT NULL,
                                                data_visione integer  NOT NULL,
                                                data_scadenza integer NOT NULL,
                                                data_emissione integer NOT NULL
            task_2 = ('Confirm with user about the top requirements', 1, 1, project_id, '2015-01-03', '2015-01-05')
            task_3 = ('%requirements', 1, 1, project_id, '2015-01-03', '2015-01-05')
    '''
    # create a database connection
    conn = create_connection(database)
    with conn:
        ce = (cert_data['sha256'],cert_data['certificate'], 1, cert_data['CA'],121212, cert_data['valid_to'],cert_data['valid_from'])
        # tasks

        cur = conn.cursor()
        cur.execute(""" select certificati.hash , certificati.frequenza , certificati.id
                from nomi_domino join certificati 
                where ? like nomi_domino.nome 
                and nomi_domino.certificato= certificati.id""", (cert_data['name'],))

        rows = cur.fetchall()
        print(rows)


        sql = ''' update certificati set frequenza=? , data_visione=? where certificati.id=? '''
        
        cur = conn.cursor()
        cur.execute(sql, (23,43234,rows[0][2]))
        conn.commit()
    

        
        sql = ''' INSERT INTO certificati(hash,certificato,frequenza,CA,data_visione,data_scadenza,data_emissione)
            VALUES(?,?,?,?,?,?,?)'''

        cur = conn.cursor()
        print(cur.lastrowid)
        cur.execute(sql, ce)
        cert_row_id=cur.lastrowid
        conn.commit()


    

        
        for dns in cert_data['dns']:
            ce = (dns,cert_row_id)
            sql = ''' INSERT INTO nomi_domino(nome,certificato)
            VALUES(?,?) '''
            cur = conn.cursor()
            cur.execute(sql, ce)
        conn.commit()
            
        
        
        
        # create tasks
        #create_task(conn, task_1)
        #create_task(conn, task_3)


if __name__ == '__main__':
    main()